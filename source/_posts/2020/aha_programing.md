---
title: " [ç¿»è­¯] AHA Programming ğŸ’¡"
date: 2020/09/30 14:44:53
---

The dangers of DRY, the web of WET, the awesomeness of AHA.

## å‰æƒ…æè¦

ç‚ºä»€éº¼æˆ‘è¦ç¿»è­¯ ? ç·´ç¿’è‹±æ–‡ï¼ŒåŒæ™‚å­¸ç¿’ç¨‹å¼é–‹ç™¼çš„åŸå‰‡ ã€‚
ç¨‹å¼é–‹ç™¼åŸå‰‡å…¶å¯¦è¶…ç´šå¤šï¼Œç¨ç¨æ•´ç†ä¸€ä¸‹ã€‚

### ç‰©ä»¶å°å‘ç¨‹å¼è¨­è¨ˆçš„ SOLID åŸå‰‡

é€™äº”å€‹çŸ¥åçš„åŸå‰‡ï¼Œå¯ä»¥ä¸€è¨€ä»¥è”½ä¹‹ --- é«˜å…§èšã€ä½è€¦åˆã€‚  
è€Œæˆ‘è‡ªå·²æ›´å–œæ­¡ [Teddy è€å¸«çš„äº”å‰‡çš†è®Š:ã€Œé¢å°åŸå§‹ç¢¼æ”¹è®Šçš„äº”ç¨®ä¸åŒç­–ç•¥ã€](http://teddy-chen-tw.blogspot.com/2014/04/solid.html)

#### SRP(Single Responsibility Principle) å–®ä¸€è·è²¬åŸå‰‡

A class should have only one reason to change  
ä»¥ä¸€å€‹é¡åˆ¥ä¾†èªªï¼Œæ‡‰è©²åªæœ‰ä¸€å€‹å¼•èµ·å®ƒè®ŠåŒ–çš„åŸå› ã€‚  

èˆ‰å€‹å¯¦å‹™ä¸Šåœ¨æ”¹å‹•ä»£ç¢¼çš„ä¾‹å­:  
ç·šä¸Šå›å ±äº†ä¸€å€‹è³¼ç‰©è»Šçš„å•é¡Œï¼Œ  
ä½ å»è¿½æŸ¥ç™¼ç¾è³¼ç‰©è»Šä¿å«ç¦®å“èˆ‡æŠ˜åƒ¹åˆ¸çš„æƒ…å¢ƒä¸‹ï¼Œæ‰æœƒç™¼ç”Ÿå•é¡Œï¼Œ  
åŒæ™‚ä¸»ç®¡è¦æ±‚ä½ ï¼Œé€™æ®µä»£ç¢¼ç™¼ç”Ÿç•°å¸¸æ™‚åŠ ä¸Š Log ä¸¦ç™¼ Email é€šçŸ¥ã€‚  

ä½ æœƒæ€éº¼æ”¹å‘¢ ? åŠ å€‹ if åˆ¤æ–·è³¼ç‰©è»Š/ç¦®å“/æŠ˜åƒ¹åˆ¸ä¹‹é–“çš„å°æ‡‰é—œä¿‚ ?  
ä½¿ç”¨ Try Catch è£œæ‰ç•°å¸¸ï¼Œè¨˜éŒ„ Log ä¸¦ç™¼é€ Email ?  
é‚£éº¼é€™äº›é‚è¼¯æ‡‰è©²è¢«åŠ åˆ°å“ªäº›é¡åˆ¥å‘¢ ?  
è«‹æ€è€ƒä¸€ä¸‹  
åœ¨é€™å€‹åŸå‰‡åº•ä¸‹ï¼Œæ‡‰è©²è€ƒæ…® if çš„é‚è¼¯å±¬æ–¼è³¼ç‰©è»Š/ç¦®å“/æŠ˜åƒ¹åˆ¸ä¸­çš„å“ªä¸€é¡ ?  
è€Œä¸‰å€‹å•†å‹™é‚è¼¯å¦‚ä½•äº’å‹•ï¼Œç•¶å‰çš„è¨­è¨ˆä¹Ÿæ˜¯è¦æ³¨æ„çš„æ–¹å‘ã€‚  
Log / Email ä¹Ÿæ˜¯åŒæ¨£çš„ï¼Œæ˜¯å¦ä¹Ÿæ‡‰è©²éš¸å±¬ç¨ç«‹é¡åˆ¥å‘¢ã€‚  
è«‹æ€è€ƒä¸€ä¸‹ï¼Œè«‹æ€è€ƒä¸€ä¸‹ã€‚  

é€™éµå¾ªé€™å€‹åŸå‰‡çš„ç¨‹å¼è¨­è¨ˆä¸‹ï¼Œå¯ä»¥æœ‰æ•ˆæ¸›å°‘å–®ä¸€é¡åˆ¥è¢«æ”¹è®Šçš„æ©Ÿæœƒã€‚  
ä»¥ä¸Šé¢æƒ…å¢ƒç‚ºä¾‹ï¼ŒLog / Email / if çš„é‚è¼¯éƒ½æ˜¯ä¸åŒçš„è·è²¬ï¼Œ  
å¦‚æœè¨­è¨ˆå¾—ç•¶ï¼Œä¸€å€‹è·è²¬éœ€è¦ç•°å‹•æ™‚åªæœƒä¿®æ”¹åˆ°ä¸€å€‹é¡åˆ¥ã€‚

#### OCP(Open Closed Principle) é–‹é–‰åŸå‰‡

software entities (classes, modules, functions, etc.) should be open for extension, but closed for modification
è»Ÿé«”å¯¦é«”(é¡åˆ¥,æ¨¡çµ„,å‡½å¼ç­‰ç­‰) æ‡‰è©²æ˜¯å¯ä»¥æ“´å±•çš„ï¼Œä½†ä¸èƒ½è¢«ä¿®æ”¹

åŒä¸Šçš„æƒ…å¢ƒï¼Œéµå¾ª OCP åœ¨é¢å°æ–°å¢éœ€æ±‚çš„æ™‚å€™ï¼Œå¯ä»¥å–®ç´”é€éæ–°å¢é¡åˆ¥æˆ–æ–¹æ³•ä¾†é”æˆéœ€æ±‚ã€‚

#### LSP(Liskov Substitution Principle) é‡Œæ°æ›¿æ›åŸå‰‡

Subtypes must be substitutable for their base types.  
åŸºåº•é¡åˆ¥æ‡‰è©²è¦èƒ½å¤ è¢«ä»–çš„è¡ç”Ÿé¡åˆ¥çµ¦æ›¿ä»£è€Œä¸å½±éŸ¿åŸæœ¬çš„åŠŸèƒ½

é€™è£¡æåˆ°çš„åŸå‰‡ï¼Œå…¶å¯¦æ˜¯å°ç¹¼æ‰¿çš„é™åˆ¶ï¼Œåœ¨å¼·å‹åˆ¥èªè¨€éƒ½å·²ç¶“æœ‰é€™æ–¹é¢çš„å¯¦ä½œäº†ã€‚
ä»¥ä¸Šè¿°çš„ä¾‹å­ä¾†èªªï¼ŒLog/Email çš„å¯¦ä½œè‡³å°‘æ‡‰è©²æœ‰ä¸€å±¤çš„æŠ½è±¡éš”é›¢ï¼Œ  
ä¸¦ä»¥ç¹¼æ‰¿æŠ½è±¡çš„å¯¦ä½œä¾†ï¼Œ  
ä¹Ÿå°±æ˜¯èªªå¯¦éš›ä¸Šå¦‚ä½• Log å¯ä»¥æ˜¯ filesã€DBã€Cloud æˆ–ä»»ä½•å…¶å®ƒçš„æ±è¥¿ã€‚  

é€™è£¡ä¹Ÿè·Ÿä¸‹é¢çš„ ISP ç›¸å‘¼æ‡‰ã€‚

#### ISP(Interface Segregation Principles) ä»‹é¢éš”é›¢åŸå‰‡

No client should be forced to depend on methods it does not use.
ä¸æ‡‰è©²è®“ä½¿ç”¨è€…å»ä¾è³´ä»–æ ¹æœ¬ä¸æœƒä½¿ç”¨åˆ°çš„æ±è¥¿

ä»‹é¢æ˜¯æ–¹æ³•çš„æŠ½è±¡ï¼Œæ‰€ä»¥æˆ‘èªç‚ºç•¶ä¸€å€‹ä»‹é¢æœ‰è¶…éä¸€å€‹æ–¹æ³•æ™‚ï¼Œ  
å°±æ‡‰è©²æ€è€ƒä¸€ä¸‹æœ‰æ²’æœ‰é•èƒŒé€™å€‹åŸå‰‡ã€‚  
å¯¦å‹™ä¸Šæœƒæœ‰è¨±å¤šçš„åŒé¡å‹çš„ä»‹é¢æ‡‰è©²è¢«æ­¸å±¬åˆ°åŒä¸€é¡ä¹‹ä¸­ï¼Œ  
ç°¡å–®å¯è¡Œçš„æ–¹æ³•æ˜¯ç•¶ä½ å¯¦ä½œä¸€å€‹ä»‹é¢æ™‚ï¼Œæœƒä¸æœƒè¦è·Ÿè‘—å¯¦ä½œè¨±å¤šç”¨ä¸åˆ°çš„æ–¹æ³•å‘¢?
å¦‚æœæœ‰çš„è©±ï¼Œè©¦è‘—å°‡å®ƒå€‘æ‹†åˆ†æˆä¸åŒçš„ä»‹é¢å§ã€‚

#### DIP(Dependency Inversion Principle) ä¾è³´åè½‰åŸå‰‡

High-level modules should not depend on low-level modules. Both should depend on abstractions (e.g. interfaces).
é«˜å±¤æ¨¡çµ„ä¸æ‡‰è©²ä¾è³´æ–¼ä½å±¤æ¨¡çµ„ã€‚å…©è€…çš†æ‡‰è©²ä¾è³´æŠ½è±¡ã€‚

Abstractions should not depend on details. Details (concrete implementations) should depend on abstractions.
æŠ½è±¡ä¸æ‡‰è©²ä¾è³´ç´°ç¯€ã€‚ç´°ç¯€æ‡‰è©²ä¾è³´æŠ½è±¡
DRY(an acronym for "")

![DRY](https://i.imgur.com/pI1bZ7h.png)

ç›´æ¥é€é wiki çš„åœ–ç‰‡ä¾†èªªæ˜ä¸Šé¢çš„ä¾‹å­ã€‚
æƒ³åƒ Object A æ˜¯è³¼ç‰©è»Š Object B æ˜¯ Logger,  
Figure 1 é¡¯ç¤ºçš„å°±æ˜¯ç›´æ¥ç›¸ä¾çš„æƒ…å¢ƒï¼Œè€Œå¦‚æœæˆ‘å€‘å¯ä»¥é€éä¸€å€‹ ILogger çš„ä»‹é¢å°±å¯ä»¥åè½‰ç›¸ä¾ï¼Œ  
ä½¿å¾—è³¼ç‰©è»Šèˆ‡ Logger éƒ½ç›¸ä¾èˆ‡ä»‹é¢ï¼Œ  
ç¾è¡Œä¸»æµçš„ç¨‹å¼ä¹Ÿéƒ½æœ‰æä¾›å°æ‡‰çš„ DI Framework æˆ– Libraryï¼Œ  
åªè¦å¥½å¥½ä½¿ç”¨ï¼Œé€™å€‹åŸå‰‡ä¸¦ä¸é›£å¯¦è¸äº†ã€‚

### å°è¨˜

èªªå¾—æœ‰é»å¤ªå¤šäº†ï¼Œä»¥ä¸Šçš„éƒ¨ä»½æœªä¾†å¦å¤–æŠ½æˆç›¸é—œçš„æ–‡ç« å§ã€‚

## ä¸»æ–‡

{% youtube wuVy7rwkCfc %}

### DRY

DRY(Don't Repeat Yourself çš„ç¸®å¯«ï¼Œä¸è¦é‡è¤‡ä½ è‡ªå·²)ï¼Œä¸€å€‹å¤è€çš„è»Ÿé«”åŸå‰‡ï¼Œ  
åœ¨ç¶­åŸºç™¾ç§‘çš„å®šç¾©å¦‚ä¸‹:

> Every piece of knowledge must have a single,  
> unambiguous, authoritative representation within a system
> æ¯ä¸€é …çŸ¥è­˜éƒ½å¿…é ˆåœ¨ç³»çµ±ä¸­å…·æœ‰å–®ä¸€ï¼Œæ˜ç¢ºï¼Œæ¬Šå¨çš„è¡¨ç¤ºå½¢å¼

å„˜ç®¡å¯¦å‹™ä¸Šæ¯”å®šç¾©æ›´ç‚ºå¯¬é¬†ï¼Œæˆ‘ä»ç„¶èªç‚ºé€™å€‹ä¸€å€‹å¥½ç¿’æ…£ã€‚  
ä½¿ç”¨ Copy/Paste æœ€å¤§çš„å•é¡Œæ˜¯ï¼Œç•¶æŸè™•ç™¼ç¾äº†ä¸€å€‹éŒ¯èª¤ï¼Œ  
æˆ‘æœƒæ„è­˜åˆ°å…¶å®ƒè¤‡è£½è²¼ä¸Šçš„åœ°æ–¹ä¹Ÿæœ‰ç›¸åŒçš„éŒ¯èª¤ï¼Œä¸¦ä¸”éœ€è¦è¢«ä¿®æ­£ã€‚

æˆ‘æ›¾ç¶“æ¥æ‰‹äº†ä¸€ä»½ä»£ç¢¼ï¼Œæœ‰è‘—å¤§é‡é‡è¤‡ä»£ç¢¼ï¼Œç‚ºäº†ä¿®æ­£ä¸€å€‹ Bug æˆ‘éœ€è¦ä¿®æ”¹ 8 å€‹åœ°æ–¹!  
æŠ½åƒåŒ–é€™éƒ¨ä»½çš„ä»£ç¢¼æˆç‚ºä¸€å€‹éš¨è™•å¯å‘¼å« function å°‡æœ‰å¾ˆå¤§çš„å¹«åŠ©ã€‚

### WET

å¦ä¸€å€‹æ¦‚å¿µæ˜¯`WET(Write Everything Twice)`

> You can ask yourself "Haven't I written this before?"
> two times, but never three
>
> ä½ å¯ä»¥å•è‡ªå·± "æˆ‘ä»¥å‰æ²’æœ‰å¯«éé€™å€‹å—ï¼Ÿ" å…©æ¬¡ï¼Œä½†å¾ä¾†æ²’æœ‰ä¸‰æ¬¡

åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæœ‰æ™‚å€™éåº¦æŠ½åƒæ¯”é‡è¤‡æ›´æœ‰å®³ã€‚  
é‚£æ˜¯ä¸€ä»½ AngularJS ä»£ç¢¼èˆ‡ä¸€äº› AngularJS controllerï¼Œ  
é€™ä»½ä»£ç¢¼å‚³é `this` çµ¦ä¸€å€‹çŒ´å­è£œä¸(Monkey Patch)æ–¹æ³•(è¨»:ä¸€ç¨®åœ¨runtimeæ™‚å‹•æ…‹ä¿®æ”¹ä»£ç¢¼çš„æŠ€å·§)ï¼Œ  
é€™å€‹æ–¹æ³•æœƒç”¨æŸç¨®æ–¹å¼æä¾› controller é¡å¤–çš„èƒ½åŠ›ã€‚  
ä½†æ˜¯é€™è¶…ç´šè®“äººå›°æƒ‘ï¼Œè€Œè®“äººå®³æ€•ä¿®æ”¹ã€‚

é€™å€‹ä»£ç¢¼åœ¨ä¸‰å€‹ä»¥ä¸Šçš„åœ°æ–¹é‡è¤‡ä½¿ç”¨ï¼Œä½†æ˜¯æŠ½è±¡æ€§å¾ˆå·®ï¼Œæˆ‘å¯§å¯ä»£ç¢¼é‡è¤‡ã€‚

### AHA

> Avoid Hasty Abstractions
> é¿å…è‰ç‡æŠ½è±¡
> prefer duplication over the wrong abstraction
> å¯§å¯é‡è¤‡ä¹Ÿä¸è¦éŒ¯èª¤æŠ½åƒ
> Optimize for change first
> ç‚ºæ”¹è®Šè€Œå„ªåŒ–

é—œéµæ˜¯æˆ‘å€‘ä¸æœƒçŸ¥é“ä»£ç¢¼çš„æœªä¾†ã€‚  
æˆ‘å€‘ç„¡æ³•ç¢ºèªï¼Œæˆ‘å€‘èƒ½ç¢ºèªçš„åªæœ‰æ”¹è®Šå¯èƒ½æœƒç™¼ç”Ÿï¼Œ  
å¦‚æœæ²’æœ‰ç™¼ç”Ÿï¼Œç‚ºä»€éº¼è¦ä¿®æ”¹ä»£ç¢¼ ?

æ³¨æ„ä»¥ä¸‹äº‹å¯¦:

- ä¸è¦ä»‹æ„é‡è¤‡ï¼Œç›´åˆ°ä½ å°é‡è¤‡ä»£ç¢¼çš„ç”¨ä¾‹æœ‰ä¿¡å¿ƒç‚ºæ­¢
- ä»£ç¢¼æœ‰å·®ç•°çš„éƒ¨ä»½ï¼Œæ˜¯å¦å¯ä»¥æŠ½å‡ºåƒæ•¸æä¾›çµ¦ä½ çš„æ–¹æ³•
- é€æ­¥åŸ·è¡Œçš„éç¨‹ï¼Œå¯ä»¥æŠ½è±¡å…±ç”¨çš„éƒ¨ä»½å°‡æœƒèºä¾†è€Œä¸Š
- ä¸ç”¨æ“”å¿ƒä½•æ™‚è©²å°é‡è¤‡ä»£ç¢¼é€²è¡ŒæŠ½è±¡ï¼Œç›´åˆ°ä½ æ¥è§¸åˆ°ä»–

### çµè«–

ä¸ç”¨æ“”å¿ƒä½•æ™‚è©²å°é‡è¤‡ä»£ç¢¼é€²è¡ŒæŠ½è±¡ï¼Œ  
é€™ä¸æ˜¯ä¸€å€‹ç¡¬æ€§è¦å®šï¼Œä¹Ÿæ˜¯ç‚ºä»€éº¼æˆ‘æ›´å–œæ­¡ AHA å‹æ–¼ DRY æˆ– WET.  

## ç›¸é—œæ–‡ç« 

- [DRY](https://en.wikipedia.org/wiki/Don%27t_repeat_yourself)
- [Code Duplicate](https://en.wikipedia.org/wiki/Duplicate_code)
- [WET](https://dev.to/wuz/stop-trying-to-be-so-dry-instead-write-everything-twice-wet-5g33)
- [äº”å‰‡çš†è®Š](http://teddy-chen-tw.blogspot.com/2014/04/solid.html)
- [[é–±è®€ç­†è¨˜] ç‰©ä»¶å°å‘çš„å¿ƒå¾—èˆ‡éš¨ç­†](https://blog.marsen.me/2020/07/27/2020/oop_experience/)
- [Kent Beck çš„å››å€‹ç°¡å–®ç¨‹å¼è¨­è¨ˆåŸå‰‡](https://ihower.tw/blog/archives/7181)
- [ä¹å¤§è¨­è¨ˆåŸå‰‡](https://codertw.com/%E7%A8%8B%E5%BC%8F%E8%AA%9E%E8%A8%80/410455/)
- [Stop trying to be so DRY, instead Write Everything Twice (WET)](https://dev.to/wuz/stop-trying-to-be-so-dry-instead-write-everything-twice-wet-5g33)

(fin)
